import{r as v,c as H,o as K,a as i,b as s,e as k,s as _,E as N,F,f as j,t as c,v as y,n as P,J as Q,j as u}from"./vue-CbfYRXie.js";import{a as m}from"./network-QpDy7ETe.js";const R={class:"p-6 font-nanum"},W={class:"mb-6 flex items-center gap-6 bg-purple-50 p-4 rounded-lg shadow-sm"},Y={class:"flex items-center gap-2"},Z=["value"],L={class:"flex items-center gap-2"},ee={class:"w-full border text-sm"},te={class:"border p-2"},se={class:"border p-2 text-center"},ae={class:"border p-2"},re={class:"border p-2"},le={class:"border p-2 text-center"},oe={class:"border p-2 text-center space-x-2"},ne=["onClick"],de=["onClick"],ie=["onClick"],ue={key:0},pe={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50"},ce={class:"bg-white rounded-lg shadow-lg w-[400px] p-6"},ge={class:"text-lg font-bold mb-4 text-purple-700"},ve={class:"space-y-3"},_e={key:0,class:"block"},be={key:1,class:"block"},fe={class:"block"},ye={class:"block"},me={class:"block"},he={__name:"AccountCategoriesGrid",setup(xe){const b=v([]),g=v(null),h=v(new Date().toISOString().split("T")[0]),p=v([]),C=v(!1),x=v("add"),r=v({id:null,parent_id:null,category_id:"",category_name:"",level:"관"}),M=H(()=>{const a=(t,e=null,o=1)=>t.filter(n=>n.parent_id===e).map(n=>({...n,depth:o,children:a(t,n.id,o+1)})).flatMap(n=>[n,...n.children]);return a(p.value)});K(async()=>{const a=await m.get("/api/departments");b.value=a.data,b.value.length>0&&(g.value=b.value[0].id,f())});const f=async()=>{if(g.value)try{const a=await m.get(`/api/accountCategories/${g.value}`,{params:{date:h.value}});p.value=Array.isArray(a.data.categories)?a.data.categories:[]}catch{p.value=[]}},V=a=>a?new Date(a).toISOString().split("T")[0]:"",z=a=>{const t=p.value.find(e=>e.id===a);return t?t.category_name:"-"},A=(a,t,e)=>{const o=b.value.find(l=>l.id===a),n=(o==null?void 0:o.dept_cd)||"XXX",d=p.value.find(l=>l.id===e);let $="00",I="00",D="00",S="00";d!=null&&d.category_id&&($=d.category_id.substr(3,2),I=d.category_id.substr(5,2),D=d.category_id.substr(7,2),S=d.category_id.substr(9,2));const E=p.value.filter(l=>l.parent_id===e&&l.level===t),G=l=>l!=null&&l.category_id?t==="항"?parseInt(l.category_id.substr(5,2))||0:t==="목"?parseInt(l.category_id.substr(7,2))||0:t==="세목"?parseInt(l.category_id.substr(9,2))||0:t==="관"&&parseInt(l.category_id.substr(3,2))||0:0,J=E.reduce((l,q)=>Math.max(l,G(q)),0),w=String(J+1).padStart(2,"0");return t==="관"&&($=w),t==="항"&&(I=w),t==="목"&&(D=w),t==="세목"&&(S=w),`${n}${$}${I}${D}${S}`},B=a=>a==="관"?"항":a==="항"?"목":"세목",U=(a,t)=>{if(x.value=a,a==="add"){const e=t?p.value.find(d=>d.id===t.id):null,o=e?B(e.level):"관",n=(e==null?void 0:e.id)||null;r.value={id:null,parent_id:n,parent_category_id:(e==null?void 0:e.category_id)||"",parent_category_name:(e==null?void 0:e.category_name)||"",category_id:A(g.value,o,n),category_name:"",level:o}}else if(a==="edit"){const e=p.value.find(o=>o.id===t.parent_id);r.value={...t,parent_category_id:(e==null?void 0:e.category_id)||"",parent_category_name:(e==null?void 0:e.category_name)||""}}C.value=!0},T=()=>{C.value=!1},O=async()=>{x.value==="add"?await m.post("/api/accountCategories",{...r.value,dept_id:g.value}):x.value==="edit"&&await m.put(`/api/accountCategories/${r.value.id}`,r.value),f(),T()},X=async a=>{confirm(`'${a.category_name}' 항목을 종료하시겠습니까?`)&&(await m.put(`/api/accountCategories/${a.id}/expire`,{valid_to:new Date().toISOString().split("T")[0]}),f())};return(a,t)=>(u(),i("div",R,[t[17]||(t[17]=s("h2",{class:"text-2xl font-bold text-purple-700 mb-6"},"📊 계정 과목 관리",-1)),s("div",W,[s("div",Y,[t[7]||(t[7]=s("label",{class:"font-semibold text-gray-700"},"부서",-1)),_(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),onChange:f,class:"border rounded p-2 focus:ring-2 focus:ring-purple-400"},[(u(!0),i(F,null,j(b.value,e=>(u(),i("option",{key:e.id,value:e.id},c(e.dept_name),9,Z))),128))],544),[[N,g.value]])]),s("div",L,[t[8]||(t[8]=s("label",{class:"font-semibold text-gray-700"},"기준일자",-1)),_(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>h.value=e),onChange:f,class:"border rounded p-2 focus:ring-2 focus:ring-purple-400"},null,544),[[y,h.value]])])]),s("table",ee,[t[10]||(t[10]=s("thead",{class:"bg-purple-100 text-gray-800"},[s("tr",null,[s("th",{class:"border p-2 text-center"},"계정명"),s("th",{class:"border p-2 text-center"},"계정ID"),s("th",{class:"border p-2 text-center"},"단계"),s("th",{class:"border p-2 text-center"},"상위 계정"),s("th",{class:"border p-2 text-center"},"유효기간"),s("th",{class:"border p-2 text-center"},"관리")])],-1)),s("tbody",null,[(u(!0),i(F,null,j(M.value,e=>(u(),i("tr",{key:e.id,class:P(["hover:bg-gray-100",{"bg-blue-200":e.level==="관","bg-gray-100":e.level==="항","bg-yellow-50":e.level==="목","bg-white":e.level==="세목"}])},[s("td",te,[s("span",{style:Q({paddingLeft:`${(e.depth-1)*40}px`})},c(e.category_name),5)]),s("td",se,c(e.category_id),1),s("td",ae,c(e.level),1),s("td",re,c(z(e.parent_id)),1),s("td",le,c(V(e.valid_from))+" ~ "+c(e.valid_to?V(e.valid_to):"현재"),1),s("td",oe,[s("button",{onClick:o=>U("add",e),class:"text-green-600 hover:underline"},"➕",8,ne),s("button",{onClick:o=>U("edit",e),class:"text-blue-600 hover:underline"},"✏️",8,de),s("button",{onClick:o=>X(e),class:"text-red-600 hover:underline"},"🗑",8,ie)])],2))),128)),M.value.length===0?(u(),i("tr",ue,[...t[9]||(t[9]=[s("td",{colspan:"6",class:"text-center p-4 text-gray-500"},"데이터가 없습니다.",-1)])])):k("",!0)])]),C.value?(u(),i("div",pe,[s("div",ce,[s("h3",ge,c(x.value==="add"?"➕ 계정 추가":"✏️ 계정 수정"),1),s("div",ve,[r.value.parent_id?(u(),i("label",_e,[t[11]||(t[11]=s("span",{class:"text-gray-700"},"부모 계정ID",-1)),_(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.parent_category_id=e),class:"w-full border rounded p-2 mt-1 bg-gray-100",readonly:""},null,512),[[y,r.value.parent_category_id]])])):k("",!0),r.value.parent_id?(u(),i("label",be,[t[12]||(t[12]=s("span",{class:"text-gray-700"},"부모 계정명",-1)),_(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.parent_category_name=e),class:"w-full border rounded p-2 mt-1 bg-gray-100",readonly:""},null,512),[[y,r.value.parent_category_name]])])):k("",!0),s("label",fe,[t[13]||(t[13]=s("span",{class:"text-gray-700"},"계정ID",-1)),_(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.category_id=e),class:"w-full border rounded p-2 mt-1 bg-gray-100",readonly:""},null,512),[[y,r.value.category_id]])]),s("label",ye,[t[14]||(t[14]=s("span",{class:"text-gray-700"},"계정명",-1)),_(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>r.value.category_name=e),class:"w-full border rounded p-2 mt-1 focus:ring-2 focus:ring-purple-400"},null,512),[[y,r.value.category_name]])]),s("label",me,[t[16]||(t[16]=s("span",{class:"text-gray-700"},"단계",-1)),_(s("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>r.value.level=e),class:"w-full border rounded p-2 mt-1 focus:ring-2 focus:ring-purple-400"},[...t[15]||(t[15]=[s("option",{value:"관"},"관",-1),s("option",{value:"항"},"항",-1),s("option",{value:"목"},"목",-1),s("option",{value:"세목"},"세목",-1)])],512),[[N,r.value.level]])])]),s("div",{class:"flex justify-end gap-3 mt-6"},[s("button",{onClick:T,class:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500"}," 취소 "),s("button",{onClick:O,class:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700"}," 저장 ")])])])):k("",!0)]))}};export{he as default};
