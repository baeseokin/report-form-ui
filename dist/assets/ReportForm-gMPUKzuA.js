const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ReportPreview-CDJK1Wko.js","assets/pdf-BllNUW5F.js","assets/index-CY_W9l9r.js","assets/vue-CbfYRXie.js","assets/network-QpDy7ETe.js","assets/index-DK5L7Jtf.css","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/ModalAlert-DBpkgysQ.js","assets/ReportPreview-thBETWz2.css"])))=>i.map(i=>d[i]);
import{_ as ae}from"./pdf-BllNUW5F.js";import{y as X,a as r,j as l,b as e,F as A,f as L,n as O,g as P,t as g,z as Z,c as V,r as F,A as W,h as H,e as Y,s as te,v as se,u as oe,o as ee,B as le,k as G,C as K,D as ne}from"./vue-CbfYRXie.js";import{a as U}from"./network-QpDy7ETe.js";import{u as q}from"./index-CY_W9l9r.js";import{_ as Q}from"./ModalAlert-DBpkgysQ.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"space-y-6 font-nanum"},de={class:"flex gap-4"},ie=["value","checked","onChange"],me={class:"grid grid-cols-3 gap-4"},pe=["value"],ce=["value"],ve=["value"],ge=["value"],be={class:"flex justify-end mt-6"},he={__name:"BasicInfoTab",props:["selectedDept","author","date","deptData","documentType","aliasName"],emits:["update:selectedDept","update:author","update:date","update:documentType","update:aliasName","next"],setup(c,{emit:j}){var b;const m=c,p=j,I=["청구지출결의서","정산지출결의서","가불지출결의서"],z=q(),{user:v}=X(z);return!m.author&&((b=v.value)!=null&&b.userName)&&p("update:author",v.value.userName),(C,d)=>{var E;return l(),r("div",ue,[d[5]||(d[5]=e("h2",{class:"text-xl font-bold text-gray-800"},"📌 기본 정보 입력",-1)),e("div",null,[d[3]||(d[3]=e("p",{class:"text-lg font-semibold text-purple-700 mb-3"},"문서 종류",-1)),e("div",de,[(l(),r(A,null,L(I,x=>e("label",{key:x,class:O(["flex-1 cursor-pointer border rounded-lg p-4 text-center shadow-sm transition hover:shadow-md",c.documentType===x?"bg-purple-100 border-purple-500 text-purple-700 font-bold":"bg-white border-gray-300"])},[e("input",{type:"radio",value:x,checked:c.documentType===x,onChange:S=>C.$emit("update:documentType",x),class:"hidden"},null,40,ie),P(" "+g(x),1)],2)),64))])]),e("div",me,[e("input",{type:"text",value:(E=Z(v))==null?void 0:E.deptName,readonly:"",class:"border p-3 rounded-lg shadow-sm bg-gray-100 cursor-not-allowed"},null,8,pe),e("input",{type:"text",value:c.author,disabled:"",class:"w-full mt-1 p-2 border rounded bg-gray-100 text-gray-600 cursor-not-allowed"},null,8,ce),e("input",{type:"date",value:c.date,onInput:d[0]||(d[0]=x=>C.$emit("update:date",x.target.value)),class:"border p-3 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-400"},null,40,ve)]),e("div",null,[d[4]||(d[4]=e("label",{class:"block text-lg font-semibold text-gray-700 mb-2"},"청구요청 별칭",-1)),e("input",{type:"text",value:c.aliasName,onInput:d[1]||(d[1]=x=>C.$emit("update:aliasName",x.target.value)),maxlength:"100",placeholder:"청구요청 별칭 입력 (최대 100자)",class:"border p-3 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-400 w-full"},null,40,ge)]),d[6]||(d[6]=e("p",{class:"text-sm text-gray-500 italic"}," ◎ 청구목록 조회화면에서 기존 청구내역을 재사용하여 보고서를 작성할 수 있습니다. ",-1)),e("div",be,[e("button",{onClick:d[2]||(d[2]=x=>C.$emit("next")),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md transition"}," 다음 → ")])])}}},xe={class:"space-y-6 font-nanum"},fe={class:"grid grid-cols-3 gap-4 text-lg font-bold"},ye={class:"p-4 bg-blue-50 border border-blue-200 rounded"},we={class:"p-4 bg-red-50 border border-red-200 rounded"},_e={class:"w-full border text-sm bg-white rounded-lg overflow-hidden mt-3 table-fixed"},ke={class:"border p-2 text-center"},$e=["checked","onChange"],Ce={class:"border p-2"},Ne=["value","onChange"],Te={class:"border p-2"},Be=["value","onChange"],Me={class:"border p-2"},Ie=["value","onInput"],De=["value","onChange"],Se={class:"border p-2"},ze=["value","onInput"],Fe=["value","onChange"],Ee={class:"border p-2"},Ve=["value","onInput"],Ae=["value","onChange"],Le={class:"border p-2 text-right"},Re=["value","onInput"],Pe={class:"bg-purple-50 font-bold"},je={class:"border p-3 text-right"},Ue={class:"flex justify-between mt-6"},Ye={class:"flex gap-3"},Oe={__name:"ExpenseTab",props:["items","deptData","selectedDept"],emits:["update:items","prev","next"],setup(c,{emit:j}){const m=c,p=j,{user:I}=X(q()),z=V(()=>{var _;return((_=I.value)==null?void 0:_.deptId)||null}),v=V(()=>{var _;return m.selectedDept||((_=I.value)==null?void 0:_.deptName)||""}),b=V(()=>m.items.reduce((_,s)=>_+(s.amount||0),0)),C=F(0),d=F(0),E=F(0),x=new Date().getFullYear(),S=V(()=>C.value-E.value),h=F(!1),i=F(""),f=()=>{if(S.value<0){i.value="허용된 예산을 초과하였습니다.",h.value=!0;return}p("next")};W(b,_=>{const s=Number(d.value)||0,t=Number(_)||0;E.value=s+t}),W(v,async _=>{if(_)try{const{data:s}=await U.get(`/api/accountCategories/${z.value}`);if(s.categories.find(o=>o.level==="관"&&o.parent_id===null)){const{data:o}=await U.get("/api/expenses/summary",{params:{deptId:z.value,year:x}});C.value=o.totalBudget||0,d.value=o.totalExpense||0,E.value=d.value}}catch{}},{immediate:!0});const k=V(()=>m.deptData[v.value]||[]),D=V(()=>k.value.filter(_=>_.level==="관").map(_=>_.category_name)),n=_=>{if(!_.gwan)return[];const s=k.value.find(t=>t.level==="관"&&t.category_name===_.gwan);return s?k.value.filter(t=>t.parent_id===s.id&&t.level==="항").map(t=>t.category_name):[]},a=_=>{if(!_.hang)return[];const s=k.value.find(t=>t.level==="항"&&t.category_name===_.hang);return s?k.value.filter(t=>t.parent_id===s.id&&t.level==="목").map(t=>t.category_name):[]},M=_=>{if(!_.mok)return[];const s=k.value.find(t=>t.level==="목"&&t.category_name===_.mok);return s?k.value.filter(t=>t.parent_id===s.id&&t.level==="세목").map(t=>t.category_name):[]},y=_=>_.semok?[_.semok]:[],N=(_,s,t)=>{const o=[...m.items];o[_]={...o[_],[s]:t},p("update:items",o)},w=(_,s,t)=>{const o={...m.items[_],[s]:t};s==="gwan"&&(o.hang="",o.mok="",o.semok="",o.detail=""),s==="hang"&&(o.mok="",o.semok="",o.detail=""),s==="mok"&&(t==="__custom__"?(o.semok="__custom__",o.detail="__custom__"):(o.semok="",o.detail="")),s==="semok"&&(t==="__custom__"?o.detail="__custom__":o.detail="");const u=[...m.items];u[_]=o,p("update:items",u)},$=_=>_?Number(_).toLocaleString():"",T=(_,s)=>{const t=_.target.value.replace(/[^0-9]/g,""),o=t?parseInt(t,10):0,u=[...m.items];u[s]={...u[s],amount:o},p("update:items",u),_.target.value=$(o)},R=()=>{const _=[...m.items,{selected:!1,gwan:"",hang:"",mok:"",semok:"",detail:"",amount:0,customMok:"",customSemok:"",customDetail:""}];p("update:items",_)},J=()=>{const _=m.items.filter(s=>!s.selected);p("update:items",_)};return(_,s)=>(l(),r("div",xe,[s[12]||(s[12]=e("h2",{class:"text-xl font-bold text-gray-800"},"💸 지출내역 입력",-1)),e("div",fe,[e("div",ye," 📊 예산 총액: "+g($(C.value))+" 원 ",1),e("div",we," 💸 지출 총액: "+g($(E.value))+" 원 ",1),e("div",{class:O(["p-4 border rounded",S.value<0?"bg-red-100 border-red-400 text-red-600":"bg-green-50 border-green-200 text-green-600"])}," 💰 잔액: "+g($(S.value))+" 원 ",3)]),e("table",_e,[s[11]||(s[11]=e("thead",{class:"bg-gradient-to-r from-blue-100 to-purple-100 text-gray-800"},[e("tr",null,[e("th",{class:"border p-3 w-14"},"선택"),e("th",{class:"border p-3 w-28"},"관"),e("th",{class:"border p-3 w-28"},"항"),e("th",{class:"border p-3 w-36"},"목"),e("th",{class:"border p-3 w-36"},"세목"),e("th",{class:"border p-3 w-44"},"지출내역"),e("th",{class:"border p-3 w-32"},"금액")])],-1)),e("tbody",null,[(l(!0),r(A,null,L(c.items,(t,o)=>(l(),r("tr",{key:o},[e("td",ke,[e("input",{type:"checkbox",checked:t.selected,onChange:u=>N(o,"selected",u.target.checked)},null,40,$e)]),e("td",Ce,[e("select",{value:t.gwan,onChange:u=>w(o,"gwan",u.target.value),class:"w-full p-2 border rounded"},[s[2]||(s[2]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(D.value,u=>(l(),r("option",{key:u},g(u),1))),128))],40,Ne)]),e("td",Te,[e("select",{value:t.hang,onChange:u=>w(o,"hang",u.target.value),class:"w-full p-2 border rounded"},[s[3]||(s[3]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(n(t),u=>(l(),r("option",{key:u},g(u),1))),128))],40,Be)]),e("td",Me,[t.mok==="__custom__"?(l(),r("input",{key:0,type:"text",value:t.customMok||"",onInput:u=>N(o,"customMok",u.target.value),placeholder:"목 직접 입력",class:"w-full p-2 border rounded"},null,40,Ie)):(l(),r("select",{key:1,value:t.mok,onChange:u=>w(o,"mok",u.target.value),class:"w-full p-2 border rounded"},[s[4]||(s[4]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(a(t),u=>(l(),r("option",{key:u},g(u),1))),128)),s[5]||(s[5]=e("option",{value:"__custom__"},"직접입력",-1))],40,De))]),e("td",Se,[t.mok==="__custom__"||t.semok==="__custom__"?(l(),r("input",{key:0,type:"text",value:t.customSemok||"",onInput:u=>N(o,"customSemok",u.target.value),placeholder:"세목 직접 입력",class:"w-full p-2 border rounded"},null,40,ze)):(l(),r("select",{key:1,value:t.semok,onChange:u=>w(o,"semok",u.target.value),class:"w-full p-2 border rounded"},[s[6]||(s[6]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(M(t),u=>(l(),r("option",{key:u},g(u),1))),128)),s[7]||(s[7]=e("option",{value:"__custom__"},"직접입력",-1))],40,Fe))]),e("td",Ee,[t.mok==="__custom__"||t.semok==="__custom__"||t.detail==="__custom__"?(l(),r("input",{key:0,type:"text",value:t.customDetail||"",onInput:u=>N(o,"customDetail",u.target.value),placeholder:"지출내역 직접 입력",class:"w-full p-2 border rounded"},null,40,Ve)):(l(),r("select",{key:1,value:t.detail,onChange:u=>N(o,"detail",u.target.value),class:"w-full p-2 border rounded"},[s[8]||(s[8]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(y(t),u=>(l(),r("option",{key:u},g(u),1))),128)),s[9]||(s[9]=e("option",{value:"__custom__"},"직접입력",-1))],40,Ae))]),e("td",Le,[e("input",{type:"text",value:$(t.amount),onInput:u=>T(u,o),class:"w-full p-2 text-right rounded border"},null,40,Re)])]))),128)),e("tr",Pe,[s[10]||(s[10]=e("td",{class:"border p-3 text-center",colspan:"6"},"합계",-1)),e("td",je,g(b.value.toLocaleString())+" 원",1)])])]),e("div",Ue,[e("div",null,[e("button",{onClick:R,class:"bg-green-500 hover:bg-green-600 text-white px-5 py-2 rounded-lg shadow-md transition"},"＋ 행 추가"),e("button",{onClick:J,class:"ml-2 bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-lg shadow-md transition"},"－ 행 삭제")]),e("div",Ye,[e("button",{onClick:s[0]||(s[0]=t=>_.$emit("prev")),class:"bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-lg shadow-md transition"},"← 이전"),e("button",{onClick:f,class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md transition"},"다음 →")])]),H(Q,{visible:h.value,title:"알림",message:i.value,onClose:s[1]||(s[1]=t=>h.value=!1)},null,8,["visible","message"])]))}},Xe={class:"space-y-6 font-nanum"},qe={class:"text-sm text-gray-600"},Ge={class:"font-semibold"},Je={key:0,class:"bg-yellow-50 border border-yellow-300 text-yellow-800 p-3 rounded"},Ke={class:"whitespace-pre-wrap text-sm"},We={key:1,class:"space-y-2"},He=["title"],Qe=["onUpdate:modelValue","placeholder"],Ze={class:"text-sm text-gray-500"},et=["onClick"],tt={key:2,class:"text-gray-500"},st={class:"flex justify-between mt-6"},ot=["disabled"],at={__name:"FileAttachTab",props:{modelValue:{type:Array,default:()=>[]},maxFileSizeMB:{type:Number,default:10},maxTotalSizeMB:{type:Number,default:30}},emits:["update:modelValue","prev","next","invalid"],setup(c,{expose:j,emit:m}){const p=c,I=m,z=F(""),v=V(()=>p.maxFileSizeMB*1024*1024),b=V(()=>p.maxTotalSizeMB*1024*1024),C=V(()=>p.modelValue.reduce((S,h)=>{var i,f,k;return S+((k=(f=h.size)!=null?f:(i=h.file)==null?void 0:i.size)!=null?k:0)},0)),d=S=>{const h=Number(S);if(!Number.isFinite(h)||h<=0)return"0 B";const i=1024,f=["B","KB","MB","GB","TB"],k=Math.min(f.length-1,Math.max(0,Math.floor(Math.log(h)/Math.log(i)))),D=h/Math.pow(i,k);return`${k===0?Math.round(D):D.toFixed(1)} ${f[k]}`},E=S=>{z.value="";const h=Array.from(S.target.files).map(n=>({file:n,name:n.name,size:n.size,aliasName:""})),i=[...p.modelValue],f=[],k=[];for(const n of h){if(i.some(M=>M.name===n.name&&M.size===n.size)){k.push(`- ${n.name} (중복)`);continue}if(n.size>v.value){f.push(`- ${n.name} (${d(n.size)}): 파일당 ${p.maxFileSizeMB}MB 초과`);continue}if(i.reduce((M,y)=>M+y.size,0)+n.size>b.value){f.push(`- ${n.name} (${d(n.size)}): 총합 ${p.maxTotalSizeMB}MB 초과`);continue}i.push(n)}I("update:modelValue",i);const D=[];k.length&&D.push(`다음 파일은 중복으로 제외되었습니다:
${k.join(`
`)}`),f.length&&D.push(`용량 제한으로 제외된 파일:
${f.join(`
`)}`),D.length&&(z.value=D.join(`

`),I("invalid",{duplicates:k,skipped:f,limit:{perFileMB:p.maxFileSizeMB,totalMB:p.maxTotalSizeMB}})),S.target.value=""},x=S=>{const h=[...p.modelValue];h.splice(S,1),I("update:modelValue",h)};return j({bytesToStr:d,totalBytes:C}),(S,h)=>(l(),r("div",Xe,[h[3]||(h[3]=e("h2",{class:"text-xl font-bold text-gray-800"},"📎 파일 첨부",-1)),e("div",qe,[e("div",null,"파일당 최대: "+g(c.maxFileSizeMB)+"MB · 총합 최대: "+g(c.maxTotalSizeMB)+"MB",1),e("div",null,[h[2]||(h[2]=P("현재 총 용량: ",-1)),e("span",Ge,g(d(C.value)),1)])]),e("input",{type:"file",multiple:"",onChange:E,class:"mb-2"},null,32),z.value?(l(),r("div",Je,[e("pre",Ke,g(z.value),1)])):Y("",!0),c.modelValue.length>0?(l(),r("ul",We,[(l(!0),r(A,null,L(c.modelValue,(i,f)=>(l(),r("li",{key:f,class:"flex items-center gap-4"},[e("span",{class:"text-gray-700 truncate max-w-[16rem]",title:i.name},g(i.name),9,He),te(e("input",{type:"text","onUpdate:modelValue":k=>i.aliasName=k,placeholder:i.name,class:"flex-1 border rounded p-2 shadow-sm focus:ring-2 focus:ring-purple-400"},null,8,Qe),[[se,i.aliasName]]),e("span",Ze,"("+g(d(i.size))+")",1),e("button",{onClick:k=>x(f),class:"text-red-500 hover:text-red-700"},"✖",8,et)]))),128))])):(l(),r("p",tt,"첨부된 파일이 없습니다.")),e("div",st,[e("button",{onClick:h[0]||(h[0]=i=>S.$emit("prev")),class:"bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-lg shadow-md transition"}," ← 이전 "),e("button",{onClick:h[1]||(h[1]=i=>S.$emit("next")),class:O(["bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md transition",{"opacity-60 cursor-not-allowed":C.value>b.value}]),disabled:C.value>b.value,title:"총 용량이 제한을 초과하면 다음 단계로 진행할 수 없습니다."}," 다음 → ",10,ot)])]))}},lt={class:"space-y-6 font-nanum"},nt={class:"p-4 bg-gray-50 rounded-lg shadow-inner space-y-1"},rt={class:"p-4 bg-gray-50 rounded-lg shadow-inner space-y-1"},ut={key:0,class:"list-disc ml-6 mt-2"},dt={class:"font-semibold text-purple-700"},it={class:"text-gray-700 ml-2"},mt={class:"text-sm text-gray-500 ml-2"},pt={key:1,class:"text-gray-500"},ct={class:"flex gap-6 items-start"},vt={class:"flex-1"},gt=["value"],bt={class:"text-right text-sm text-gray-500 mt-1"},ht={class:"w-[260px]"},xt={class:"relative inline-block"},ft={class:"flex justify-between"},yt={__name:"ConfirmTab",props:["documentType","author","date","totalAmount","comment","items","aliasName","attachedFiles"],emits:["update:comment","prev","generate"],setup(c,{emit:j}){const m=c,{user:p}=X(q()),I=V(()=>{var n;return((n=p.value)==null?void 0:n.deptName)||""}),z=oe(),v=F(null);let b,C=!1;ee(()=>{b=v.value.getContext("2d"),b.strokeStyle="black",b.lineWidth=2,v.value.addEventListener("mousedown",d),v.value.addEventListener("mousemove",E),v.value.addEventListener("mouseup",x),v.value.addEventListener("mouseleave",x),v.value.addEventListener("touchstart",S,{passive:!1}),v.value.addEventListener("touchmove",h,{passive:!1}),v.value.addEventListener("touchend",x)});const d=n=>{C=!0,b.beginPath(),b.moveTo(n.offsetX,n.offsetY)},E=n=>{C&&(b.lineTo(n.offsetX,n.offsetY),b.stroke())},x=()=>{C=!1},S=n=>{n.preventDefault();const a=v.value.getBoundingClientRect(),M=n.touches[0];C=!0,b.beginPath(),b.moveTo(M.clientX-a.left,M.clientY-a.top)},h=n=>{if(n.preventDefault(),!C)return;const a=v.value.getBoundingClientRect(),M=n.touches[0];b.lineTo(M.clientX-a.left,M.clientY-a.top),b.stroke()},i=()=>{b.clearRect(0,0,v.value.width,v.value.height)},f=F(!1),k=async()=>{var n,a;try{const M=$=>$.map(T=>({gwan:T.gwan,hang:T.hang,mok:T.mok==="__custom__"?T.customMok:T.mok,semok:T.semok==="__custom__"?T.customSemok:T.semok,detail:T.detail==="__custom__"?T.customDetail:T.detail,amount:T.amount})),y={documentType:m.documentType,deptName:I.value,author:m.author,userId:p.value.userId,date:m.date,totalAmount:m.totalAmount,comment:m.comment,aliasName:m.aliasName,items:M(m.items)||[]},N=await U.post("/api/approval",y,{withCredentials:!0});if(!N.data.success)throw new Error("서버 저장 실패");const w=N.data.id;if(((n=m.attachedFiles)==null?void 0:n.length)>0){const $=new FormData,T=[];m.attachedFiles.forEach(R=>{$.append("files",R.file),T.push(R.aliasName||R.name)}),$.append("aliasNames",JSON.stringify(T)),await U.post(`/api/approval/${w}/files`,$,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0})}if(p.value){const $=new FormData;if($.append("requestId",w),$.append("approver_role",((a=p.value.roles[0])==null?void 0:a.role_name)||"작성자"),$.append("approver_user_id",p.value.userId),$.append("comment",m.comment||""),v.value){const T=await new Promise(R=>v.value.toBlob(R,"image/png"));T&&$.append("signature",T,"signature.png")}await U.post("/api/approval/history",$,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0})}f.value=!0}catch{alert("❌ 결재요청 실패")}},D=()=>{f.value=!1,z.push("/approvalList")};return(n,a)=>{var M;return l(),r("div",lt,[a[11]||(a[11]=e("h2",{class:"text-xl font-bold text-gray-800"},"📄 최종 확인",-1)),e("div",nt,[e("p",null,[a[2]||(a[2]=e("strong",null,"문서 종류:",-1)),P(" "+g(c.documentType),1)]),e("p",null,[a[3]||(a[3]=e("strong",null,"부서명:",-1)),P(" "+g(I.value),1)]),e("p",null,[a[4]||(a[4]=e("strong",null,"작성자:",-1)),P(" "+g(c.author),1)]),e("p",null,[a[5]||(a[5]=e("strong",null,"제출일자:",-1)),P(" "+g(c.date),1)]),e("p",null,[a[6]||(a[6]=e("strong",null,"청구총액:",-1)),P(" ₩"+g(c.totalAmount.toLocaleString()),1)]),e("p",null,[a[7]||(a[7]=e("strong",null,"청구요청 별칭:",-1)),P(" "+g(c.aliasName),1)])]),e("div",rt,[a[8]||(a[8]=e("h3",{class:"text-lg font-semibold text-gray-800"},"📎 첨부파일",-1)),c.attachedFiles&&c.attachedFiles.length>0?(l(),r("ul",ut,[(l(!0),r(A,null,L(c.attachedFiles,(y,N)=>(l(),r("li",{key:N},[e("span",dt,g(y.aliasName||y.name),1),e("span",it,"/ "+g(y.name),1),e("span",mt," ("+g((y.size/1024).toFixed(1))+" KB) ",1)]))),128))])):(l(),r("p",pt,"첨부된 파일이 없습니다."))]),e("div",ct,[e("div",vt,[a[9]||(a[9]=e("h2",{class:"text-xl font-bold text-gray-800"},"📌 추가 의견",-1)),e("textarea",{value:c.comment,onInput:a[0]||(a[0]=y=>n.$emit("update:comment",y.target.value)),rows:"6",maxlength:"500",placeholder:"여기에 코멘트를 입력하세요...",class:"w-full h-60 border rounded-lg p-3 shadow-sm focus:ring-2 focus:ring-purple-400 resize-y"},null,40,gt),e("p",bt,g(((M=c.comment)==null?void 0:M.length)||0)+"/500 ",1)]),e("div",ht,[a[10]||(a[10]=e("h2",{class:"text-xl font-bold text-gray-800"},"✍️ 서명",-1)),e("div",xt,[e("canvas",{ref_key:"canvas",ref:v,width:"240",height:"240",class:"border rounded w-[240px] h-[240px] touch-none"},null,512),e("button",{onClick:i,class:"absolute top-1 right-1 text-gray-500 hover:text-red-600 bg-white rounded-full px-1"}," ✕ ")])])]),e("div",ft,[e("button",{onClick:a[1]||(a[1]=y=>n.$emit("prev")),class:"bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-lg shadow-md transition"}," ← 이전 "),e("div",{class:"flex gap-3"},[e("button",{onClick:k,class:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-purple-700 text-white px-6 py-3 rounded-lg shadow-md transition"}," 📤 결재요청 ")])]),H(Q,{visible:f.value,title:"알림",message:"결재요청이 완료되었습니다.",onClose:D},null,8,["visible"])])}}},wt={class:"space-y-6 font-nanum px-2"},_t={class:"flex flex-col gap-2"},kt=["value","checked","onChange"],$t={class:"space-y-3"},Ct=["value"],Nt=["value"],Tt=["value"],Bt=["value"],Mt={class:"flex justify-center mt-4"},It={__name:"BasicInfoTabMobile",props:["selectedDept","author","date","deptData","documentType","aliasName"],emits:["update:selectedDept","update:author","update:date","update:documentType","update:aliasName","next"],setup(c,{emit:j}){var b;const m=c,p=j,I=["청구지출결의서","정산지출결의서","가불지출결의서"],z=q(),{user:v}=X(z);return!m.author&&((b=v.value)!=null&&b.userName)&&p("update:author",v.value.userName),(C,d)=>{var E;return l(),r("div",wt,[d[8]||(d[8]=e("h2",{class:"text-lg font-bold text-gray-800 mb-2"},"📌 기본 정보 입력",-1)),e("div",null,[d[3]||(d[3]=e("p",{class:"text-base font-semibold text-purple-700 mb-2"},"문서 종류",-1)),e("div",_t,[(l(),r(A,null,L(I,x=>e("label",{key:x,class:O(["cursor-pointer border rounded-lg px-4 py-3 text-center shadow-sm transition hover:shadow-md",c.documentType===x?"bg-purple-100 border-purple-500 text-purple-700 font-bold":"bg-white border-gray-300"])},[e("input",{type:"radio",value:x,checked:c.documentType===x,onChange:S=>C.$emit("update:documentType",x),class:"hidden"},null,40,kt),P(" "+g(x),1)],2)),64))])]),e("div",$t,[e("div",null,[d[4]||(d[4]=e("label",{class:"block text-sm font-semibold text-gray-600 mb-1"},"부서명",-1)),e("input",{type:"text",value:(E=Z(v))==null?void 0:E.deptName,readonly:"",class:"border p-3 rounded-lg shadow-sm bg-gray-100 w-full cursor-not-allowed text-sm"},null,8,Ct)]),e("div",null,[d[5]||(d[5]=e("label",{class:"block text-sm font-semibold text-gray-600 mb-1"},"작성자",-1)),e("input",{type:"text",value:c.author,disabled:"",class:"w-full mt-1 p-2 border rounded bg-gray-100 text-gray-600 cursor-not-allowed text-sm"},null,8,Nt)]),e("div",null,[d[6]||(d[6]=e("label",{class:"block text-sm font-semibold text-gray-600 mb-1"},"제출일자",-1)),e("input",{type:"date",value:c.date,onInput:d[0]||(d[0]=x=>C.$emit("update:date",x.target.value)),class:"border p-3 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-400 w-full text-sm"},null,40,Tt)])]),e("div",null,[d[7]||(d[7]=e("label",{class:"block text-sm font-semibold text-gray-600 mb-1"},"청구요청 별칭",-1)),e("input",{type:"text",value:c.aliasName,onInput:d[1]||(d[1]=x=>C.$emit("update:aliasName",x.target.value)),maxlength:"100",placeholder:"청구요청 별칭 입력",class:"border p-3 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-400 w-full text-sm"},null,40,Bt)]),d[9]||(d[9]=e("p",{class:"text-xs text-gray-500 italic leading-snug"}," ◎ 청구목록 조회화면에서 기존 청구내역을 재사용하여 보고서를 작성할 수 있습니다. ",-1)),e("div",Mt,[e("button",{onClick:d[2]||(d[2]=x=>C.$emit("next")),class:"bg-blue-500 hover:bg-blue-600 text-white w-full py-3 rounded-lg shadow-md transition text-base font-semibold"}," 다음 → ")])])}}},Dt={class:"space-y-6 font-nanum px-2"},St={class:"grid grid-cols-1 gap-3 text-base font-bold"},zt={class:"p-3 bg-blue-50 border border-blue-200 rounded"},Ft={class:"p-3 bg-red-50 border border-red-200 rounded"},Et={class:"absolute top-2 right-2"},Vt=["checked","onChange"],At={class:"space-y-2"},Lt=["value","onChange"],Rt=["value","onChange"],Pt=["value","onInput"],jt=["value","onChange"],Ut=["value","onInput"],Yt=["value","onChange"],Ot=["value","onInput"],Xt=["value","onChange"],qt=["value","onInput"],Gt={class:"bg-purple-100 p-4 rounded-lg text-right font-bold text-gray-700"},Jt={class:"flex flex-col gap-3 mt-6"},Kt={class:"flex gap-2"},Wt={__name:"ExpenseTabMobile",props:["items","deptData"],emits:["update:items","prev","next"],setup(c,{emit:j}){const m=c,p=j,{user:I}=X(q()),z=V(()=>{var s;return((s=I.value)==null?void 0:s.deptId)||null}),v=V(()=>{var s;return((s=I.value)==null?void 0:s.deptName)||""}),b=V(()=>m.items.reduce((s,t)=>s+(t.amount||0),0)),C=V(()=>m.items.map(s=>({...s,formattedAmount:s.amount?Number(s.amount).toLocaleString():""}))),d=F(0),E=F(0),x=F(0),S=new Date().getFullYear(),h=V(()=>d.value-x.value);W(b,s=>{const t=Number(E.value)||0,o=Number(s)||0;x.value=t+o}),W(v,async s=>{if(s)try{const{data:t}=await U.get("/api/expenses/summary",{params:{deptId:z.value,year:S}});d.value=t.totalBudget||0,E.value=t.totalExpense||0,x.value=E.value}catch{}},{immediate:!0});const i=V(()=>m.deptData[v.value]||[]),f=V(()=>i.value.filter(s=>s.level==="관").map(s=>s.category_name)),k=s=>{if(!s.gwan)return[];const t=i.value.find(o=>o.level==="관"&&o.category_name===s.gwan);return t?i.value.filter(o=>o.parent_id===t.id&&o.level==="항").map(o=>o.category_name):[]},D=s=>{if(!s.hang)return[];const t=i.value.find(o=>o.level==="항"&&o.category_name===s.hang);return t?i.value.filter(o=>o.parent_id===t.id&&o.level==="목").map(o=>o.category_name):[]},n=s=>{if(!s.mok)return[];const t=i.value.find(o=>o.level==="목"&&o.category_name===s.mok);return t?i.value.filter(o=>o.parent_id===t.id&&o.level==="세목").map(o=>o.category_name):[]},a=s=>s.semok?[s.semok]:[],M=(s,t,o)=>{const u=[...m.items];u[s]={...u[s],[t]:o},p("update:items",u)},y=(s,t,o)=>{const u={...m.items[s],[t]:o};t==="mok"&&(o==="__custom__"?(u.semok="__custom__",u.detail="__custom__"):(u.semok="",u.detail="")),t==="semok"&&(o==="__custom__"?u.detail="__custom__":u.detail="");const B=[...m.items];B[s]=u,p("update:items",B)},N=s=>s?Number(s).toLocaleString():"",w=(s,t)=>{const o=s.target.value.replace(/[^0-9]/g,""),u=o?parseInt(o,10):0,B=[...m.items];B[t]={...B[t],amount:u},p("update:items",B)},$=()=>{const s=[...m.items,{selected:!1,gwan:"",hang:"",mok:"",semok:"",detail:"",amount:0,customMok:"",customSemok:"",customDetail:""}];p("update:items",s)},T=()=>{const s=m.items.filter(t=>!t.selected);p("update:items",s)},R=F(!1),J=F(""),_=()=>{h.value<0?(J.value="허용된 예산을 초과하였습니다.",R.value=!0):p("next")};return(s,t)=>(l(),r("div",Dt,[t[16]||(t[16]=e("h2",{class:"text-lg font-bold text-gray-800"},"💸 지출내역 입력",-1)),e("div",St,[e("div",zt," 📊 예산 총액: "+g(N(d.value))+" 원 ",1),e("div",Ft," 💸 지출 총액: "+g(N(x.value))+" 원 ",1),e("div",{class:O(["p-3 border rounded",h.value<0?"bg-red-100 border-red-300 text-red-600":"bg-green-50 border-green-200 text-green-700"])}," 💰 잔액: "+g(N(h.value))+" 원 ",3)]),(l(!0),r(A,null,L(C.value,(o,u)=>(l(),r("div",{key:u,class:"border rounded-lg p-4 bg-white shadow-sm space-y-3 relative"},[e("div",Et,[e("input",{type:"checkbox",checked:o.selected,onChange:B=>M(u,"selected",B.target.checked)},null,40,Vt)]),e("div",At,[t[8]||(t[8]=e("label",{class:"block text-sm font-semibold text-gray-600"},"관",-1)),e("select",{value:o.gwan,onChange:B=>y(u,"gwan",B.target.value),class:"w-full p-2 border rounded text-sm"},[t[2]||(t[2]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(f.value,B=>(l(),r("option",{key:B},g(B),1))),128))],40,Lt),t[9]||(t[9]=e("label",{class:"block text-sm font-semibold text-gray-600"},"항",-1)),e("select",{value:o.hang,onChange:B=>y(u,"hang",B.target.value),class:"w-full p-2 border rounded text-sm"},[t[3]||(t[3]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(k(o),B=>(l(),r("option",{key:B},g(B),1))),128))],40,Rt),t[10]||(t[10]=e("label",{class:"block text-sm font-semibold text-gray-600"},"목",-1)),o.mok==="__custom__"?(l(),r("input",{key:0,type:"text",value:o.customMok||"",onInput:B=>M(u,"customMok",B.target.value),placeholder:"목 직접 입력",class:"w-full p-2 border rounded text-sm"},null,40,Pt)):(l(),r("select",{key:1,value:o.mok,onChange:B=>y(u,"mok",B.target.value),class:"w-full p-2 border rounded text-sm"},[t[4]||(t[4]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(D(o),B=>(l(),r("option",{key:B},g(B),1))),128)),t[5]||(t[5]=e("option",{value:"__custom__"},"직접입력",-1))],40,jt)),t[11]||(t[11]=e("label",{class:"block text-sm font-semibold text-gray-600"},"세목",-1)),o.mok==="__custom__"||o.semok==="__custom__"?(l(),r("input",{key:2,type:"text",value:o.customSemok||"",onInput:B=>M(u,"customSemok",B.target.value),placeholder:"세목 직접 입력",class:"w-full p-2 border rounded text-sm"},null,40,Ut)):(l(),r("select",{key:3,value:o.semok,onChange:B=>y(u,"semok",B.target.value),class:"w-full p-2 border rounded text-sm"},[t[6]||(t[6]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(n(o),B=>(l(),r("option",{key:B},g(B),1))),128)),t[7]||(t[7]=e("option",{value:"__custom__"},"직접입력",-1))],40,Yt))]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-semibold text-gray-600"},"지출내역",-1)),o.mok==="__custom__"||o.semok==="__custom__"||o.detail==="__custom__"?(l(),r("input",{key:0,type:"text",value:o.customDetail||"",onInput:B=>M(u,"customDetail",B.target.value),placeholder:"지출내역 직접 입력",class:"w-full p-2 border rounded text-sm"},null,40,Ot)):(l(),r("select",{key:1,value:o.detail,onChange:B=>M(u,"detail",B.target.value),class:"w-full p-2 border rounded text-sm"},[t[12]||(t[12]=e("option",{disabled:"",value:""},"선택",-1)),(l(!0),r(A,null,L(a(o),B=>(l(),r("option",{key:B},g(B),1))),128)),t[13]||(t[13]=e("option",{value:"__custom__"},"직접입력",-1))],40,Xt))]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-semibold text-gray-600"},"금액",-1)),e("input",{type:"text",value:o.formattedAmount,onInput:B=>w(B,u),inputmode:"numeric",pattern:"[0-9]*",class:"w-full p-2 text-right rounded border text-sm"},null,40,qt)])]))),128)),e("div",Gt," 합계: "+g(b.value.toLocaleString())+" 원 ",1),e("div",Jt,[e("div",{class:"flex gap-2"},[e("button",{onClick:$,class:"flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg shadow-md transition text-sm"}," ＋ 행 추가 "),e("button",{onClick:T,class:"flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg shadow-md transition text-sm"}," － 행 삭제 ")]),e("div",Kt,[e("button",{onClick:t[0]||(t[0]=o=>s.$emit("prev")),class:"flex-1 bg-gray-400 hover:bg-gray-500 text-white py-3 rounded-lg shadow-md transition text-sm"}," ← 이전 "),e("button",{onClick:_,class:"flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg shadow-md transition text-sm"}," 다음 → ")])]),H(Q,{visible:R.value,title:"알림",message:J.value,onClose:t[1]||(t[1]=o=>R.value=!1)},null,8,["visible","message"])]))}},Ht={class:"space-y-4 font-nanum"},Qt={class:"text-xs text-gray-600"},Zt={class:"font-semibold"},es={key:0,class:"bg-yellow-50 border border-yellow-300 text-yellow-800 p-2 rounded"},ts={class:"whitespace-pre-wrap text-xs"},ss={key:1,class:"space-y-2"},os=["title"],as=["onUpdate:modelValue","placeholder"],ls={class:"text-[11px] text-gray-500 shrink-0"},ns=["onClick"],rs={key:2,class:"text-gray-500 text-sm"},us={class:"flex justify-between mt-4"},ds=["disabled"],is={__name:"FileAttachTabMobile",props:{modelValue:{type:Array,default:()=>[]},maxFileSizeMB:{type:Number,default:10},maxTotalSizeMB:{type:Number,default:30}},emits:["update:modelValue","prev","next","invalid"],setup(c,{expose:j,emit:m}){const p=c,I=m,z=F(""),v=V(()=>p.maxFileSizeMB*1024*1024),b=V(()=>p.maxTotalSizeMB*1024*1024),C=V(()=>p.modelValue.reduce((h,i)=>{var f,k,D;return h+((D=(k=i.size)!=null?k:(f=i.file)==null?void 0:f.size)!=null?D:0)},0)),d=h=>{const i=Number(h);if(!Number.isFinite(i)||i<=0)return"0 B";const f=1024,k=["B","KB","MB","GB","TB"],D=Math.min(k.length-1,Math.max(0,Math.floor(Math.log(i)/Math.log(f)))),n=i/Math.pow(f,D);return`${D===0?Math.round(n):n.toFixed(1)} ${k[D]}`},E=V(()=>d(C.value)),x=h=>{z.value="";const i=Array.from(h.target.files).map(a=>({file:a,name:a.name,size:a.size,aliasName:""})),f=[...p.modelValue],k=[],D=[];for(const a of i){if(f.some(y=>y.name===a.name&&y.size===a.size)){D.push(`- ${a.name} (중복)`);continue}if(a.size>v.value){k.push(`- ${a.name} (${d(a.size)}): 파일당 ${p.maxFileSizeMB}MB 초과`);continue}if(f.reduce((y,N)=>y+N.size,0)+a.size>b.value){k.push(`- ${a.name} (${d(a.size)}): 총합 ${p.maxTotalSizeMB}MB 초과`);continue}f.push(a)}I("update:modelValue",f);const n=[];D.length&&n.push(`다음 파일은 중복으로 제외되었습니다:
${D.join(`
`)}`),k.length&&n.push(`용량 제한으로 제외된 파일:
${k.join(`
`)}`),n.length&&(z.value=n.join(`

`),I("invalid",{duplicates:D,skipped:k,limit:{perFileMB:p.maxFileSizeMB,totalMB:p.maxTotalSizeMB}})),h.target.value=""},S=h=>{const i=[...p.modelValue];i.splice(h,1),I("update:modelValue",i)};return j({bytesToStr:d,totalBytes:C,totalBytesLabel:E}),(h,i)=>(l(),r("div",Ht,[i[3]||(i[3]=e("h2",{class:"text-lg font-bold text-gray-800"},"📎 파일 첨부",-1)),e("div",Qt,[e("div",null,"파일당 최대: "+g(c.maxFileSizeMB)+"MB · 총합 최대: "+g(c.maxTotalSizeMB)+"MB",1),e("div",null,[i[2]||(i[2]=P("현재 총 용량: ",-1)),e("span",Zt,g(E.value),1)])]),e("input",{type:"file",multiple:"",onChange:x,class:"mb-1"},null,32),z.value?(l(),r("div",es,[e("pre",ts,g(z.value),1)])):Y("",!0),c.modelValue.length>0?(l(),r("ul",ss,[(l(!0),r(A,null,L(c.modelValue,(f,k)=>(l(),r("li",{key:k,class:"flex items-center gap-2"},[e("span",{class:"text-gray-700 truncate max-w-[9rem]",title:f.name},g(f.name),9,os),te(e("input",{type:"text","onUpdate:modelValue":D=>f.aliasName=D,placeholder:f.name,class:"flex-1 border rounded p-2 text-sm shadow-sm focus:ring-2 focus:ring-purple-400"},null,8,as),[[se,f.aliasName]]),e("span",ls,"("+g(d(f.size))+")",1),e("button",{onClick:D=>S(k),class:"text-red-500 hover:text-red-700 text-base shrink-0"},"✖",8,ns)]))),128))])):(l(),r("p",rs,"첨부된 파일이 없습니다.")),e("div",us,[e("button",{onClick:i[0]||(i[0]=f=>h.$emit("prev")),class:"bg-gray-400 hover:bg-gray-500 text-white px-5 py-2 rounded-lg shadow-md transition text-sm"}," ← 이전 "),e("button",{onClick:i[1]||(i[1]=f=>h.$emit("next")),class:O(["bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md transition text-sm",{"opacity-60 cursor-not-allowed":C.value>b.value}]),disabled:C.value>b.value,title:"총 용량이 제한을 초과하면 다음 단계로 진행할 수 없습니다."}," 다음 → ",10,ds)])]))}},ms=re(is,[["__scopeId","data-v-105a9b6a"]]),ps={class:"space-y-6 font-nanum px-3"},cs={class:"p-4 bg-gray-50 rounded-lg shadow space-y-2 text-sm"},vs={class:"p-4 bg-gray-50 rounded-lg shadow"},gs={key:0,class:"space-y-3"},bs={class:"text-purple-700 font-medium"},hs={class:"text-gray-600 text-xs"},xs={class:"text-gray-400 text-xs"},fs={key:1,class:"text-gray-500 text-sm"},ys={class:"space-y-6"},ws=["value"],_s={class:"text-right text-xs text-gray-500 mt-1"},ks={class:"relative inline-block"},$s={class:"space-y-3 mt-6"},Cs={__name:"ConfirmTabMobile",props:["documentType","author","date","totalAmount","comment","items","aliasName","attachedFiles"],emits:["update:comment","prev","generate"],setup(c,{emit:j}){const m=c,{user:p}=X(q()),I=V(()=>{var n;return((n=p.value)==null?void 0:n.deptName)||""}),z=oe(),v=F(null);let b,C=!1;ee(()=>{b=v.value.getContext("2d"),b.strokeStyle="black",b.lineWidth=2,v.value.addEventListener("mousedown",d),v.value.addEventListener("mousemove",E),v.value.addEventListener("mouseup",x),v.value.addEventListener("mouseleave",x),v.value.addEventListener("touchstart",S,{passive:!1}),v.value.addEventListener("touchmove",h,{passive:!1}),v.value.addEventListener("touchend",x)});const d=n=>{C=!0,b.beginPath(),b.moveTo(n.offsetX,n.offsetY)},E=n=>{C&&(b.lineTo(n.offsetX,n.offsetY),b.stroke())},x=()=>{C=!1},S=n=>{n.preventDefault();const a=v.value.getBoundingClientRect(),M=n.touches[0];C=!0,b.beginPath(),b.moveTo(M.clientX-a.left,M.clientY-a.top)},h=n=>{if(n.preventDefault(),!C)return;const a=v.value.getBoundingClientRect(),M=n.touches[0];b.lineTo(M.clientX-a.left,M.clientY-a.top),b.stroke()},i=()=>{b.clearRect(0,0,v.value.width,v.value.height)},f=F(!1),k=async()=>{var n,a;try{const M=$=>$.map(T=>({gwan:T.gwan,hang:T.hang,mok:T.mok==="__custom__"?T.customMok:T.mok,semok:T.semok==="__custom__"?T.customSemok:T.semok,detail:T.detail==="__custom__"?T.customDetail:T.detail,amount:T.amount})),y={documentType:m.documentType,deptName:I.value,author:m.author,userId:p.value.userId,date:m.date,totalAmount:m.totalAmount,comment:m.comment,aliasName:m.aliasName,items:M(m.items)||[]},N=await U.post("/api/approval",y,{withCredentials:!0});if(!N.data.success)throw new Error("서버 저장 실패");const w=N.data.id;if(((n=m.attachedFiles)==null?void 0:n.length)>0){const $=new FormData,T=[];m.attachedFiles.forEach(R=>{$.append("files",R.file),T.push(R.aliasName||R.name)}),$.append("aliasNames",JSON.stringify(T)),await U.post(`/api/approval/${w}/files`,$,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0})}if(p.value){const $=new FormData;if($.append("requestId",w),$.append("approver_role",((a=p.value.roles[0])==null?void 0:a.role_name)||"작성자"),$.append("approver_user_id",p.value.userId),$.append("comment",m.comment||""),v.value){const T=await new Promise(R=>v.value.toBlob(R,"image/png"));T&&$.append("signature",T,"signature.png")}await U.post("/api/approval/history",$,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0})}f.value=!0}catch{alert("❌ 결재요청 실패")}},D=()=>{f.value=!1,z.push("/approvalList")};return(n,a)=>{var M;return l(),r("div",ps,[a[11]||(a[11]=e("h2",{class:"text-lg font-bold text-gray-800"},"📄 최종 확인",-1)),e("div",cs,[e("p",null,[a[2]||(a[2]=e("strong",null,"문서 종류:",-1)),P(" "+g(c.documentType),1)]),e("p",null,[a[3]||(a[3]=e("strong",null,"부서명:",-1)),P(" "+g(I.value),1)]),e("p",null,[a[4]||(a[4]=e("strong",null,"작성자:",-1)),P(" "+g(c.author),1)]),e("p",null,[a[5]||(a[5]=e("strong",null,"제출일자:",-1)),P(" "+g(c.date),1)]),e("p",null,[a[6]||(a[6]=e("strong",null,"청구총액:",-1)),P(" ₩"+g(c.totalAmount.toLocaleString()),1)]),e("p",null,[a[7]||(a[7]=e("strong",null,"청구요청 별칭:",-1)),P(" "+g(c.aliasName),1)])]),e("div",vs,[a[8]||(a[8]=e("h3",{class:"text-base font-semibold text-gray-800 mb-2"},"📎 첨부파일",-1)),c.attachedFiles&&c.attachedFiles.length>0?(l(),r("div",gs,[(l(!0),r(A,null,L(c.attachedFiles,(y,N)=>(l(),r("div",{key:N,class:"p-3 border rounded-lg bg-white shadow-sm"},[e("p",bs,g(y.aliasName||y.name),1),e("p",hs,g(y.name),1),e("p",xs,g((y.size/1024).toFixed(1))+" KB",1)]))),128))])):(l(),r("p",fs,"첨부된 파일이 없습니다."))]),e("div",ys,[e("div",null,[a[9]||(a[9]=e("h2",{class:"text-base font-bold text-gray-800"},"📌 추가 의견",-1)),e("textarea",{value:c.comment,onInput:a[0]||(a[0]=y=>n.$emit("update:comment",y.target.value)),rows:"5",maxlength:"500",placeholder:"여기에 코멘트를 입력하세요...",class:"w-full border rounded-lg p-3 shadow-sm focus:ring-2 focus:ring-purple-400 text-sm"},null,40,ws),e("p",_s,g(((M=c.comment)==null?void 0:M.length)||0)+"/500 ",1)]),e("div",null,[a[10]||(a[10]=e("h2",{class:"text-base font-bold text-gray-800"},"✍️ 서명",-1)),e("div",ks,[e("canvas",{ref_key:"canvas",ref:v,width:"200",height:"200",class:"border rounded w-[200px] h-[200px] touch-none max-[480px]:w-[180px] max-[480px]:h-[180px]"},null,512),e("button",{onClick:i,class:"absolute top-1 right-1 text-gray-500 hover:text-red-600 bg-white rounded-full px-1 text-sm"}," ✕ ")])])]),e("div",$s,[e("button",{onClick:a[1]||(a[1]=y=>n.$emit("prev")),class:"w-full bg-gray-400 hover:bg-gray-500 text-white py-3 rounded-lg shadow-md transition"}," ← 이전 "),e("button",{onClick:k,class:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white py-3 rounded-lg shadow-md transition"}," 📤 결재요청 ")]),H(Q,{visible:f.value,title:"알림",message:"결재요청이 완료되었습니다.",onClose:D},null,8,["visible"])])}}},Ns={class:"min-h-screen bg-gradient-to-br from-gray-100 to-gray-200 flex flex-col items-center p-10 font-nanum"},Ts={class:"w-full max-w-full sm:max-w-2xl md:max-w-4xl lg:max-w-6xl bg-white shadow-2xl rounded-2xl p-4 sm:p-6 md:p-8 border border-gray-200"},Bs={key:0,class:"flex border-b mb-6"},Ms=["onClick"],Is={key:0,class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-md flex justify-around py-2"},Ds=["onClick"],Ls={__name:"ReportForm",setup(c){const j=ne(()=>ae(()=>import("./ReportPreview-CDJK1Wko.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),m=F(!1);typeof window!="undefined"&&(m.value=window.innerWidth<=768,window.addEventListener("resize",()=>{m.value=window.innerWidth<=768}));const p=["기본정보","지출내역","파일첨부","최종 확인"],I=F("기본정보"),z=F("청구지출결의서"),v=F(""),b=F(""),C=F(new Date().toISOString().slice(0,10)),d=F(""),E=F({}),x=F([{selected:!0,gwan:"",hang:"",mok:"",semok:"",detail:"",amount:0}]),S=F(""),h=F(null),i=F([]),f=le();ee(async()=>{var y;try{const w=(await U.get("/api/departments")).data,$={};for(const T of w){const R=await U.get(`/api/accountCategories/${T.id}`,{params:{date:new Date().toISOString().split("T")[0]}});$[T.dept_name]=R.data.categories||[]}E.value=$}catch{}if(f.params.id)try{const w=(await U.get(`/api/approval/detail/${f.params.id}`,{withCredentials:!0})).data;z.value=w.document_type,v.value=w.dept_name,b.value=w.author,C.value=((y=w.request_date)==null?void 0:y.slice(0,10))||new Date().toISOString().slice(0,10),d.value=w.aliasName,x.value=(w.items||[]).map($=>({gwan:$.gwan,hang:$.hang,mok:$.mok,semok:$.semok,detail:$.detail,amount:$.amount})),C.value=new Date().toISOString().slice(0,10),i.value=[]}catch{}});const k=V(()=>x.value.reduce((y,N)=>y+(N.amount||0),0)),D=()=>{const y=p.indexOf(I.value);y<p.length-1&&(I.value=p[y+1])},n=()=>{const y=p.indexOf(I.value);y>0&&(I.value=p[y-1])},a=y=>{h.value={documentType:z.value,deptName:y.deptName,author:b.value,date:C.value,totalAmount:k.value,aliasName:d.value,items:JSON.parse(JSON.stringify(x.value)),comment:S.value,attachedFiles:i.value||[]}},M=()=>h.value=null;return(y,N)=>(l(),r("div",Ns,[e("div",Ts,[m.value?Y("",!0):(l(),r("div",Bs,[(l(),r(A,null,L(p,w=>e("button",{key:w,onClick:$=>I.value=w,class:O(["flex-1 py-3 text-center font-semibold transition",I.value===w?"border-b-4 border-purple-600 text-purple-700":"text-gray-500 hover:text-gray-700"])},g(w),11,Ms)),64))])),I.value==="기본정보"?(l(),G(K(m.value?It:he),{key:1,documentType:z.value,"onUpdate:documentType":N[0]||(N[0]=w=>z.value=w),selectedDept:v.value,"onUpdate:selectedDept":N[1]||(N[1]=w=>v.value=w),author:b.value,"onUpdate:author":N[2]||(N[2]=w=>b.value=w),date:C.value,"onUpdate:date":N[3]||(N[3]=w=>C.value=w),aliasName:d.value,"onUpdate:aliasName":N[4]||(N[4]=w=>d.value=w),"dept-data":E.value,onNext:D},null,40,["documentType","selectedDept","author","date","aliasName","dept-data"])):Y("",!0),I.value==="지출내역"?(l(),G(K(m.value?Wt:Oe),{key:2,items:x.value,"onUpdate:items":N[5]||(N[5]=w=>x.value=w),"dept-data":E.value,"selected-dept":v.value,onPrev:n,onNext:D},null,40,["items","dept-data","selected-dept"])):Y("",!0),I.value==="파일첨부"?(l(),G(K(m.value?ms:at),{key:3,modelValue:i.value,"onUpdate:modelValue":N[6]||(N[6]=w=>i.value=w),onPrev:n,onNext:D},null,40,["modelValue"])):Y("",!0),I.value==="최종 확인"?(l(),G(K(m.value?Cs:yt),{key:4,"document-type":z.value,"selected-dept":v.value,author:b.value,date:C.value,"total-amount":k.value,items:x.value,"alias-name":d.value,comment:S.value,"onUpdate:comment":N[7]||(N[7]=w=>S.value=w),"attached-files":i.value,onPrev:n,onGenerate:a},null,40,["document-type","selected-dept","author","date","total-amount","items","alias-name","comment","attached-files"])):Y("",!0)]),m.value?(l(),r("div",Is,[(l(),r(A,null,L(p,w=>e("button",{key:w,onClick:$=>I.value=w,class:O(["flex-1 py-2 text-center font-semibold transition",I.value===w?"text-purple-700":"text-gray-500"])},g(w),11,Ds)),64))])):Y("",!0),h.value?(l(),G(Z(j),{key:1,report:h.value,onClose:M},null,8,["report"])):Y("",!0)]))}};export{Ls as default};
