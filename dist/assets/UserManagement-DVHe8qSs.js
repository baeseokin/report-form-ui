import{a as m}from"./network-QpDy7ETe.js";import{a as d,b as s,s as a,E as g,F as b,f as w,t as p,v as u,e as y,n as h,g as f,j as i}from"./vue-CbfYRXie.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={name:"UserManagement",data(){return{users:[],departments:[],roles:[],roleNameToId:{},roleIdToName:{},roleIdSet:new Set,selectedUser:null,filters:{dept:"",role:"",name:""}}},methods:{async fetchDepartments(){try{const o=await m.get("/api/departments");this.departments=o.data.map(e=>({id:e.id,name:e.dept_name}))}catch{}},async fetchRoles(){try{const o=await m.get("/api/roles");this.roles=o.data.map(e=>({id:Number(e.role_id),name:e.role_name})),this.roleNameToId=Object.fromEntries(this.roles.map(e=>[e.name,e.id])),this.roleIdToName=Object.fromEntries(this.roles.map(e=>[e.id,e.name])),this.roleIdSet=new Set(this.roles.map(e=>e.id))}catch{}},normalizeRoles(o){return o==null?[]:(Array.isArray(o)?o:String(o).split(",").map(l=>l.trim()).filter(Boolean)).map(l=>isNaN(l)?this.roleNameToId[l]:Number(l)).filter(l=>this.roleIdSet.has(l))},roleIdsToNames(o){return!o||o.length===0?"":o.map(e=>this.roleIdToName[e]).filter(Boolean).join(", ")},async searchUsers(){try{const o=await m.get("/api/users/search",{params:this.filters});this.users=o.data.map(e=>{var r;const l=this.normalizeRoles((r=e.roleIds)!=null?r:e.roles),c=e.roleNames&&e.roleNames.length?e.roleNames:this.roleIdsToNames(l);return{...e,roles:l,roleNames:c}})}catch{}},selectUser(o){const e=this.normalizeRoles(o.roles);this.selectedUser={...o,roles:e,newPassword:"",confirmPassword:"",isNew:!1}},newUser(){var o;this.selectedUser={id:null,userId:"",name:"",email:"",dept:((o=this.departments[0])==null?void 0:o.name)||"",roles:[],newPassword:"",confirmPassword:"",isNew:!0}},clearSelection(){this.selectedUser=null},async createUser(){var o,e;try{const l=this.selectedUser;if(l.roles=this.normalizeRoles(l.roles),!l.userId)return alert("ì‚¬ìš©ìIDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");if(!l.name)return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");if(!l.dept)return alert("ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.");if(!l.newPassword)return alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");if(l.newPassword!==l.confirmPassword)return alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");const c={userId:l.userId,name:l.name,email:l.email,dept:l.dept,roles:Array.isArray(l.roles)?l.roles:[],password:l.newPassword};await m.post("/api/users",c),alert("ì‚¬ìš©ìê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤."),this.selectedUser=null,this.searchUsers()}catch(l){alert(((e=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:e.message)||"ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},async updateUser(){var o,e;try{if(!this.selectedUser)return;if(this.selectedUser.newPassword&&this.selectedUser.newPassword!==this.selectedUser.confirmPassword){alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");return}const{isNew:l,confirmPassword:c,newPassword:r,...n}=this.selectedUser,t={...n,roles:this.normalizeRoles(n.roles)};r&&(t.newPassword=r),await m.put(`/api/users/${this.selectedUser.id}`,t),alert("ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."),this.searchUsers()}catch(l){alert(((e=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:e.message)||"ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},async deleteUser(){var o,e;if(!this.selectedUser||this.selectedUser.isNew)return this.clearSelection();if(confirm("ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await m.delete(`/api/users/${this.selectedUser.id}`),alert("ì‚¬ìš©ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),this.selectedUser=null,this.searchUsers()}catch(l){alert(((e=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:e.message)||"ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}},async mounted(){await Promise.all([this.fetchDepartments(),this.fetchRoles()]),this.searchUsers()}},v={class:"flex h-screen font-nanum"},k={class:"w-1/2 border-r overflow-y-auto bg-gray-50 flex flex-col"},N={class:"flex items-center justify-between p-4 border-b bg-white"},I={class:"p-4 space-y-4 border-b bg-white shadow-inner"},_=["value"],P=["value"],S={class:"pt-2"},V={class:"flex-1 overflow-y-auto p-4"},C={class:"bg-white rounded-lg shadow overflow-hidden"},T={class:"w-full text-sm border-collapse"},j=["onClick"],z={class:"border px-3 py-2"},D={class:"border px-3 py-2"},R={class:"border px-3 py-2"},B={class:"border px-3 py-2"},A={class:"text-gray-700"},E={key:0},M={class:"w-1/2 p-6 overflow-y-auto bg-gray-50"},F={key:0},O={class:"flex items-center justify-between mb-6"},L={class:"text-2xl font-bold text-purple-700"},q={key:0,class:"space-x-2"},G={class:"space-y-4 bg-white p-6 rounded-lg shadow"},H={class:"block"},J=["disabled"],K={class:"block"},Q={class:"block"},W={class:"block"},X=["value"],Y={class:"block"},Z=["value"],$={class:"grid grid-cols-1 gap-4"},ee={class:"block"},se={class:"font-semibold text-gray-700"},te={class:"block"},re={class:"flex space-x-4 mt-6"},le={key:1,class:"text-gray-500 text-lg flex items-center justify-center h-full"};function oe(o,e,l,c,r,n){return i(),d("div",v,[s("div",k,[s("div",N,[e[18]||(e[18]=s("h2",{class:"text-2xl font-bold text-purple-700"},"ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬",-1)),s("button",{onClick:e[0]||(e[0]=(...t)=>n.newUser&&n.newUser(...t)),class:"px-3 py-2 text-sm bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-lg shadow hover:from-emerald-600 hover:to-teal-700 transition"}," ï¼‹ ì‚¬ìš©ì ë“±ë¡ ")]),s("div",I,[s("div",null,[e[20]||(e[20]=s("label",{class:"block text-sm font-semibold text-gray-700"},"ë¶€ì„œ",-1)),a(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.filters.dept=t),class:"w-full border rounded-lg px-3 py-2"},[e[19]||(e[19]=s("option",{value:""},"ì „ì²´",-1)),(i(!0),d(b,null,w(r.departments,t=>(i(),d("option",{key:t.id,value:t.name},p(t.name),9,_))),128))],512),[[g,r.filters.dept]])]),s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm font-semibold text-gray-700"},"ì—­í• ",-1)),a(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.filters.role=t),class:"w-full border rounded-lg px-3 py-2"},[e[21]||(e[21]=s("option",{value:""},"ì „ì²´",-1)),(i(!0),d(b,null,w(r.roles,t=>(i(),d("option",{key:t.id,value:t.name},p(t.name),9,P))),128))],512),[[g,r.filters.role]])]),s("div",null,[e[23]||(e[23]=s("label",{class:"block text-sm font-semibold text-gray-700"},"ì‚¬ìš©ìëª…",-1)),a(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>r.filters.name=t),placeholder:"ì´ë¦„ ì…ë ¥",class:"w-full border rounded-lg px-3 py-2"},null,512),[[u,r.filters.name]])]),s("div",S,[s("button",{onClick:e[4]||(e[4]=(...t)=>n.searchUsers&&n.searchUsers(...t)),class:"w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg shadow hover:from-purple-600 hover:to-indigo-700 transition"}," ì¡°íšŒ ")])]),s("div",V,[s("div",C,[s("table",T,[e[25]||(e[25]=s("thead",null,[s("tr",{class:"bg-purple-100 text-gray-700"},[s("th",{class:"border px-3 py-2 w-32"},"ì‚¬ìš©ìID"),s("th",{class:"border px-3 py-2 w-32"},"ì‚¬ìš©ìëª…"),s("th",{class:"border px-3 py-2 w-32"},"ë¶€ì„œëª…"),s("th",{class:"border px-3 py-2"},"ì—­í• ")])],-1)),s("tbody",null,[(i(!0),d(b,null,w(r.users,t=>(i(),d("tr",{key:t.id,onClick:ne=>n.selectUser(t),class:h(["cursor-pointer hover:bg-purple-50 transition",r.selectedUser&&r.selectedUser.id===t.id?"bg-purple-200 font-semibold":""])},[s("td",z,p(t.userId),1),s("td",D,p(t.name),1),s("td",R,p(t.dept),1),s("td",B,[s("span",A,p(t.roleNames||"-"),1)])],10,j))),128)),r.users.length===0?(i(),d("tr",E,[...e[24]||(e[24]=[s("td",{colspan:"4",class:"text-center text-gray-500 p-4"},"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.",-1)])])):y("",!0)])])])])]),s("div",M,[r.selectedUser?(i(),d("div",F,[s("div",O,[s("h2",L,p(r.selectedUser.isNew?"ğŸ†• ì‚¬ìš©ì ë“±ë¡":"ğŸ“‹ ì‚¬ìš©ì ìƒì„¸"),1),r.selectedUser.isNew?y("",!0):(i(),d("div",q,[s("button",{onClick:e[5]||(e[5]=(...t)=>n.newUser&&n.newUser(...t)),class:"px-3 py-2 text-sm bg-emerald-500 text-white rounded-lg shadow hover:bg-emerald-600"},"ì‹ ê·œ ë“±ë¡"),s("button",{onClick:e[6]||(e[6]=(...t)=>n.clearSelection&&n.clearSelection(...t)),class:"px-3 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"},"ì„ íƒ í•´ì œ")]))]),s("div",G,[s("label",H,[e[26]||(e[26]=s("span",{class:"font-semibold text-gray-700"},"ì‚¬ìš©ìID",-1)),a(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>r.selectedUser.userId=t),disabled:!r.selectedUser.isNew,class:"border px-3 py-2 rounded-lg w-64 ml-2 disabled:bg-gray-100 disabled:text-gray-500",placeholder:"ì˜ˆ: user01"},null,8,J),[[u,r.selectedUser.userId]])]),s("label",K,[e[27]||(e[27]=s("span",{class:"font-semibold text-gray-700"},"ì´ë¦„",-1)),a(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>r.selectedUser.name=t),class:"border px-3 py-2 rounded-lg w-64 ml-2"},null,512),[[u,r.selectedUser.name]])]),s("label",Q,[e[28]||(e[28]=s("span",{class:"font-semibold text-gray-700"},"ì´ë©”ì¼",-1)),a(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>r.selectedUser.email=t),class:"border px-3 py-2 rounded-lg w-64 ml-2"},null,512),[[u,r.selectedUser.email]])]),s("label",W,[e[29]||(e[29]=s("span",{class:"font-semibold text-gray-700"},"ë¶€ì„œ",-1)),a(s("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>r.selectedUser.dept=t),class:"border px-3 py-2 rounded-lg w-64 ml-2"},[(i(!0),d(b,null,w(r.departments,t=>(i(),d("option",{key:t.id,value:t.name},p(t.name),9,X))),128))],512),[[g,r.selectedUser.dept]])]),s("label",Y,[e[30]||(e[30]=s("span",{class:"font-semibold text-gray-700"},"ì—­í• ",-1)),a(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>r.selectedUser.roles=t),multiple:"",class:"border px-3 py-2 rounded-lg w-64 ml-2 h-32"},[(i(!0),d(b,null,w(r.roles,t=>(i(),d("option",{key:t.id,value:t.id},p(t.name),9,Z))),128))],512),[[g,r.selectedUser.roles]])]),s("div",$,[s("label",ee,[s("span",se,p(r.selectedUser.isNew?"ë¹„ë°€ë²ˆí˜¸":"ìƒˆ ë¹„ë°€ë²ˆí˜¸"),1),a(s("input",{type:"password","onUpdate:modelValue":e[12]||(e[12]=t=>r.selectedUser.newPassword=t),class:"border px-3 py-2 rounded-lg w-64 ml-2"},null,512),[[u,r.selectedUser.newPassword]])]),s("label",te,[e[31]||(e[31]=s("span",{class:"font-semibold text-gray-700"},"ë¹„ë°€ë²ˆí˜¸ í™•ì¸",-1)),a(s("input",{type:"password","onUpdate:modelValue":e[13]||(e[13]=t=>r.selectedUser.confirmPassword=t),class:"border px-3 py-2 rounded-lg w-64 ml-2"},null,512),[[u,r.selectedUser.confirmPassword]])])]),s("div",re,[r.selectedUser.isNew?(i(),d("button",{key:0,onClick:e[14]||(e[14]=(...t)=>n.createUser&&n.createUser(...t)),class:"px-6 py-2 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-lg shadow hover:from-emerald-600 hover:to-teal-700 transition"}," ë“±ë¡í•˜ê¸° ")):(i(),d("button",{key:1,onClick:e[15]||(e[15]=(...t)=>n.updateUser&&n.updateUser(...t)),class:"px-6 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg shadow hover:from-purple-600 hover:to-indigo-700 transition"}," ì €ì¥í•˜ê¸° ")),r.selectedUser.isNew?y("",!0):(i(),d("button",{key:2,onClick:e[16]||(e[16]=(...t)=>n.deleteUser&&n.deleteUser(...t)),class:"px-6 py-2 bg-red-500 text-white rounded-lg shadow hover:bg-red-600 transition"}," ì‚­ì œí•˜ê¸° ")),s("button",{onClick:e[17]||(e[17]=(...t)=>n.clearSelection&&n.clearSelection(...t)),class:"px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"}," ì·¨ì†Œ ")])])])):(i(),d("div",le,[...e[32]||(e[32]=[f(" ì¢Œì¸¡ì—ì„œ ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ê±°ë‚˜, ìƒë‹¨ì˜ ",-1),s("span",{class:"mx-2 font-semibold text-emerald-700"},"ì‚¬ìš©ì ë“±ë¡",-1),f(" ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œ ìƒì„±í•˜ì„¸ìš”. ",-1)])]))])])}const pe=x(U,[["render",oe],["__scopeId","data-v-89bd7189"]]);export{pe as default};
